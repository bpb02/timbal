"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9770],{3153:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>h,default:()=>u,frontMatter:()=>l,metadata:()=>n,toc:()=>g});const n=JSON.parse('{"id":"agents/evals","title":"Evals","description":"AI outputs are non-deterministic \u2014 the same input can yield different results. Evals in Timbal help you measure, test, and improve your agents and flows with automated, LLM-powered checks.","source":"@site/docs/agents/evals.md","sourceDirName":"agents","slug":"/agents/evals","permalink":"/agents/evals","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Evals","sidebar":"docsSidebar"},"sidebar":"docsSidebar","previous":{"title":"Voice","permalink":"/agents/voice"},"next":{"title":"Overview","permalink":"/flows/"}}');var i=s(4848),r=s(8453),o=s(5495);const l={title:"Evals",sidebar:"docsSidebar"},h="Automated Testing for Timbal Agents",a={},g=[{value:"What Are Evals in Timbal?",id:"what-are-evals-in-timbal",level:2},{value:"Types of Evals",id:"types-of-evals",level:3},{value:"Getting Started",id:"getting-started",level:2},{value:"1. Prepare Your Test Cases",id:"1-prepare-your-test-cases",level:3},{value:"2. Set Up Your Evaluation Agents",id:"2-set-up-your-evaluation-agents",level:3},{value:"3. Run the Evals",id:"3-run-the-evals",level:3},{value:"Understanding Eval Results",id:"understanding-eval-results",level:2},{value:"Summary",id:"summary",level:2}];function c(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"automated-testing-for-timbal-agents",children:"Automated Testing for Timbal Agents"})}),"\n",(0,i.jsxs)(t.p,{children:["AI outputs are non-deterministic \u2014 the same input can yield different results. ",(0,i.jsx)(t.strong,{children:"Evals"})," in Timbal help you measure, test, and improve your agents and flows with automated, LLM-powered checks."]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:"what-are-evals-in-timbal",children:"What Are Evals in Timbal?"}),"\n",(0,i.jsx)(t.p,{children:"Evals are automated tests that assess your agent's outputs and tool usage. They use LLMs to compare your agent's process (the tools it used and how) and its result (the answer it gave) to the expected process and result. Evals can be run locally, in the cloud, or as part of your CI/CD pipeline"}),"\n",(0,i.jsx)(t.h3,{id:"types-of-evals",children:"Types of Evals"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)("span",{style:{color:"var(--timbal-purple)"},children:(0,i.jsx)("strong",{children:"Process Evals"})}),": Did the agent use the right tools, in the right order, with the right inputs?"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)("span",{style:{color:"var(--timbal-purple)"},children:(0,i.jsx)("strong",{children:"Result Evals"})}),": Did the agent produce the correct answer, regardless of wording or formatting?"]}),"\n"]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,i.jsx)(t.h3,{id:"1-prepare-your-test-cases",children:"1. Prepare Your Test Cases"}),"\n",(0,i.jsxs)(t.p,{children:["Create a CSV file (e.g. ",(0,i.jsx)(t.code,{children:"eval.csv"}),") with columns like:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"prompt"}),": The question or task for the agent."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"result"}),": The expected answer."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"process"}),": The expected sequence of tools and inputs."]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"2-set-up-your-evaluation-agents",children:"2. Set Up Your Evaluation Agents"}),"\n",(0,i.jsx)(t.p,{children:"Define evaluation prompts for process and result checking, and create Timbal agents for each:"}),"\n",(0,i.jsx)(o.A,{language:"python",code:'from timbal import Agent\n\nEVAL_PROCESS_PROMPT = """You are a helpful assistant that evaluates if the process done by the llm is correct.\nCompare two processes: the first is correct, check if in the second were used the correct tools and the correct inputs.\nIgnore case and formatting differences in all inputs.\nIf the process is correct, return true, otherwise return false.\nReturn: {"explanation": "Brief reasoning", "correct": true/false}\n"""\n\nEVAL_RESULT_PROMPT = """You are a helpful assistant that evaluates if the result is correct.\nCompare two results: the first is correct, check if the second answers the question.\nYou have to focus on the answer being right (dimensions, material, codes, links, lists, etc.) not on the exact wording.\nIf the result is correct, return true, otherwise return false.\nReturn: {"explanation": "Brief reasoning", "correct": true/false}\n"""\n\neval_process = Agent(model="gpt-4.1-nano", system_prompt=EVAL_PROCESS_PROMPT)\neval_result = Agent(model="gpt-4.1-nano", system_prompt=EVAL_RESULT_PROMPT)'}),"\n",(0,i.jsx)(t.h3,{id:"3-run-the-evals",children:"3. Run the Evals"}),"\n",(0,i.jsx)(t.p,{children:"For each test case:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Run your agent or flow with the prompt."}),"\n",(0,i.jsx)(t.li,{children:"Collect the output and the tools used (from the agent's memory)."}),"\n",(0,i.jsx)(t.li,{children:"Pass the actual and expected process/result to the evaluation agents."}),"\n",(0,i.jsx)(t.li,{children:"Get a pass/fail and an explanation for each."}),"\n"]}),"\n",(0,i.jsx)(o.A,{language:"python",code:'import pandas as pd\nfrom timbal.state import RunContext\n# Your Timbal flow\nfrom flow import flow  \n\ncsv_eval = pd.read_csv("./eval.csv")\nfor index, row in csv_eval.iterrows():\n  prompt = row["prompt"]\n  expected_result = row["result"]\n  expected_process = row["process"]\n\n  flow_output_event = await flow.complete(prompt=prompt)\n  result = flow_output_event.output.content[0].text\n  run_context = RunContext(parent_id=flow_output_event.run_id)\n\n  # Extract tools_used from memory (see your Timbal memory docs for details)\n  # Your logic here\n  tools_used = ...  \n\n  # Evaluate process\n  eval_process_prompt = f"Question: {prompt}\nProcess: {tools_used}\nExpected process: {expected_process}"\n  eval_process_output = await eval_process.complete(context=run_context, prompt=eval_process_prompt)\n  print(eval_process_output.output.content[0].text)\n\n  # Evaluate result\n  eval_result_prompt = f"Question: {prompt}\nResult: {result}\nExpected result: {expected_result}"\n  eval_result_output = await eval_result.complete(context=run_context, prompt=eval_result_prompt)\n  print(eval_result_output.output.content[0].text)'}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:"understanding-eval-results",children:"Understanding Eval Results"}),"\n",(0,i.jsx)(t.p,{children:"Each eval returns:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"correct"}),": true/false"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"explanation"}),": a brief reasoning for the decision"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"You can use these results to:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Track your agent's quality over time"}),"\n",(0,i.jsx)(t.li,{children:"Debug and improve your prompts, tools, or workflows"}),"\n",(0,i.jsx)(t.li,{children:"Catch regressions before they reach production"}),"\n"]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Evals"})," in Timbal let you automatically check if your agent is doing the right thing, both in process and result."]}),"\n",(0,i.jsx)(t.li,{children:"You get detailed, LLM-powered feedback for every test case."}),"\n",(0,i.jsx)(t.li,{children:"This helps you build more reliable, trustworthy AI systems."}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},5495:(e,t,s)=>{s.d(t,{A:()=>g});var n=s(6540),i=s(1765),r=s(4848);(void 0!==s.g?s.g:window).Prism=i.My;const o={...i.Zj.github,plain:{...i.Zj.github.plain,backgroundColor:"#2d2d2d",color:"#ffffff"},styles:i.Zj.github.styles.map((e=>({...e,types:e.types})))},l={from:"custom-highlight-pink",import:"custom-highlight-pink","=":"custom-highlight-pink",timbal:"custom-highlight-green",Agent:"custom-highlight-green",steps:"custom-highlight-green",perplexity:"custom-highlight-green",InMemorySaver:"custom-highlight-green",fal:"custom-highlight-green",text_to_image:"custom-highlight-green",RunContext:"custom-highlight-green",twilio:"custom-highlight-green",whatsapp:"custom-highlight-green",model:"custom-highlight-orange",query:"custom-highlight-orange",context:"custom-highlight-orange",system_prompt:"custom-highlight-orange",tools:"custom-highlight-orange",parent_id:"custom-highlight-orange",id:"custom-highlight-orange",model_id:"custom-highlight-orange",to:"custom-highlight-orange",message:"custom-highlight-orange",resource:"custom-highlight-orange",max_results:"custom-highlight-orange",message_id:"custom-highlight-orange",thread_id:"custom-highlight-orange",subject:"custom-highlight-orange",body:"custom-highlight-orange",template_sid:"custom-highlight-orange",template_params:"custom-highlight-orange",scope:"custom-highlight-orange",folder:"custom-highlight-orange",destination:"custom-highlight-orange",text:"custom-highlight-orange",voice_id:"custom-highlight-orange",memory_id:"custom-highlight-orange",location:"custom-highlight-orange",memory_window_size:"custom-highlight-orange","(":"custom-highlight-yellow-dark",")":"custom-highlight-yellow-dark","[":"custom-highlight-purple-pink","]":"custom-highlight-purple-pink","{":"custom-highlight-yellow-dark","}":"custom-highlight-yellow-dark",",":"#fffff",Flow:"custom-highlight-green",await:"custom-highlight-pink",as:"custom-highlight-pink",def:"custom-highlight-blue",async:"custom-highlight-blue","-":"#fffff",">":"#fffff",":":"#fffff",".":"#fffff",state:"custom-highlight-green",savers:"custom-highlight-green",sharepoint:"custom-highlight-green",Tool:"custom-highlight-green",list_directory:"custom-highlight-green-fn",gen_images:"custom-highlight-green-fn",download_file:"custom-highlight-green-fn",TimbalPlatformSaver:"custom-highlight-green",sql:"custom-highlight-green",postgres:"custom-highlight-green",return:"custom-highlight-pink",for:"custom-highlight-pink",in:"custom-highlight-pink",if:"custom-highlight-pink",datetime:"custom-highlight-green",elevenlabs:"custom-highlight-green",gmail:"custom-highlight-green",JSONLSaver:"custom-highlight-green",openai:"custom-highlight-green",messages:"custom-highlight-green",types:"custom-highlight-green",File:"custom-highlight-green",postgres_query:"custom-highlight-green-fn",PGConfig:"custom-highlight-green",get_message:"custom-highlight-green-fn",get_thread:"custom-highlight-green-fn",get_datetime:"custom-highlight-green-fn",send_message:"custom-highlight-green-fn",run_sql_query:"custom-highlight-green-fn",create_draft_message:"custom-highlight-green-fn",send_whatsapp_message:"custom-highlight-green-fn",send_whatsapp_template:"custom-highlight-green-fn",openai_stt:"custom-highlight-green-fn",elevenlabs_tts:"custom-highlight-green-fn",validate:"custom-highlight-green-fn",complete:"custom-highlight-green-fn",print:"custom-highlight-green-fn",search:"custom-highlight-green-fn",search_internet:"custom-highlight-green-fn",stt:"custom-highlight-green-fn",tts:"custom-highlight-green-fn",run:"custom-highlight-green-fn",search_web:"custom-highlight-green-fn",set_input:"custom-highlight-green-fn",extract_text:"custom-highlight-green-fn",text_processor:"custom-highlight-green-fn",convert_to_database:"custom-highlight-green-fn",get_weather:"custom-highlight-green-fn",get_time:"custom-highlight-green-fn",add_step:"custom-highlight-green-fn",add_link:"custom-highlight-green-fn",set_output:"custom-highlight-green-fn",parse_documentation:"custom-highlight-green-fn",create_database:"custom-highlight-green-fn",add_llm:"custom-highlight-green-fn",compile:"custom-highlight-green-fn",str:"custom-highlight-green"},h=new RegExp(`(${Object.keys(l).map((e=>/^[a-zA-Z0-9_]+$/.test(e)?`\\b${e}\\b`:e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"))).join("|")})`,"g"),a=/"([^"]*)"/g;function g(e){const{title:t,children:s,highlight:g}=e,[c,u]=(0,n.useState)(!1),d=g?g.split(",").map((e=>parseInt(e.trim()))):[];return(0,r.jsxs)("div",{className:"custom-codeblock-container",style:{borderRadius:"12px",overflow:"hidden",border:"1px solid #333",marginBottom:"1.5em",position:"relative"},children:[t&&(0,r.jsx)("div",{style:{background:"#2d2d2d",color:"#fff",padding:"0.3em 1em",fontSize:"0.85em",borderBottom:"1.5px solid #444",letterSpacing:"0.01em",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,r.jsx)("span",{children:t})}),(0,r.jsx)(i.f4,{theme:o,...e,children:t=>{let{className:s,style:n,tokens:i,getLineProps:o,getTokenProps:g}=t;const p=i.map((e=>e.map((e=>e.content)).join(""))).join("\n");let m=0,f=0,x=0,v=0;i.forEach((e=>{e.forEach((e=>{const t=g({token:e}).children;"string"==typeof t&&"state_saver"===t.trim()&&f++,"string"==typeof t&&"audio_file"===t.trim()&&x++,"string"==typeof t&&"db_config"===t.trim()&&v++,"string"==typeof t&&"sql"===t.trim()&&0}))}));let _=0,j=0,y=0,w=0,b=[];const k=e=>{const t=(e-1)%3;return 0===t?"custom-highlight-yellow-dark":1===t?{color:"#ff69b4"}:{color:"#42a5f5"}};return(0,r.jsxs)("pre",{className:s,style:{...n,border:"none",borderRadius:0,color:"bash"===e.language?"#ffffff":n.color,margin:0,position:"relative"},children:[(0,r.jsx)("button",{className:"copy-icon-btn"+(c?" copied":""),onClick:()=>{navigator.clipboard.writeText(p),u(!0),setTimeout((()=>u(!1)),2e3)},"aria-label":"Copy code",type:"button",children:c?(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{fill:"#fff",d:"m9.55 15.15l8.475-8.475q.3-.3.7-.3t.7.3t.3.713t-.3.712l-9.175 9.2q-.3.3-.7.3t-.7-.3L4.55 13q-.3-.3-.288-.712t.313-.713t.713-.3t.712.3z"})}):(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",children:(0,r.jsxs)("g",{fill:"none",stroke:"#fff",strokeWidth:"1.5",children:[(0,r.jsx)("path",{d:"M6 11c0-2.828 0-4.243.879-5.121C7.757 5 9.172 5 12 5h3c2.828 0 4.243 0 5.121.879C21 6.757 21 8.172 21 11v5c0 2.828 0 4.243-.879 5.121C19.243 22 17.828 22 15 22h-3c-2.828 0-4.243 0-5.121-.879C6 20.243 6 18.828 6 16z"}),(0,r.jsx)("path",{d:"M6 19a3 3 0 0 1-3-3v-6c0-3.771 0-5.657 1.172-6.828S7.229 2 11 2h4a3 3 0 0 1 3 3"})]})})}),i.map(((t,s)=>{const n=t.map((e=>g({token:e}).children)).join(""),i=d.includes(s+1),c={...o({line:t}).style,...i?{backgroundColor:"rgba(255, 255, 255, 0.1)",borderLeft:"3px solid #bcb6ff",paddingLeft:"8px",marginLeft:"-8px"}:{}};return/^\s*#/.test(n)?(0,r.jsx)("div",{...o({line:t}),style:c,children:t.map(((t,s)=>{const n=g({token:t});return(0,r.jsx)("span",{className:(e.language,"custom-highlight-comment"),children:n.children},s)}))},s):(0,r.jsx)("div",{...o({line:t}),style:c,children:t.map(((t,s)=>{const n=g({token:t});let i=n.children;if("bash"===e.language)return(0,r.jsx)("span",{style:{color:"#ffffff"},children:i},s);const o=[];let c,u=0;for(;null!==(c=a.exec(i));){if(c.index>u){let e=i.slice(u,c.index).replace(h,(e=>`<span class="${l[e]}">${e}</span>`));e=e.replace(/\\b\\d+(?:\\.\\d+)?\\b/g,(e=>`<span class="custom-highlight-purple">${e}</span>`)),o.push(e)}o.push(`<span class="custom-highlight-yellow">${c[0]}</span>`),u=c.index+c[0].length}if(u<i.length){let e=i.slice(u).replace(h,(e=>`<span class="${l[e]}">${e}</span>`));e=e.replace(/\\b\\d+(?:\\.\\d+)?\\b/g,(e=>`<span class="custom-highlight-purple">${e}</span>`)),o.push(e)}const d=o.join("");if("string"==typeof i&&"prompt"===i.trim())return m++,1===m?(0,r.jsx)("span",{className:"custom-highlight-orange",children:i},s):2===m?(0,r.jsx)("span",{style:{color:"#fff"},children:i},s):(0,r.jsx)("span",{...n},s);if("string"==typeof i&&"audio_file"===i.trim())return j++,3===x&&2===j?(0,r.jsx)("span",{className:"custom-highlight-orange",children:i},s):(0,r.jsx)("span",{...n},s);if("string"==typeof i&&"state_saver"===i.trim())return _++,1===f&&1===_||2===f&&1===_||3===f&&2===_?(0,r.jsx)("span",{className:"custom-highlight-orange",children:i},s):(0,r.jsx)("span",{...n},s);if("string"==typeof i&&"db_config"===i.trim())return y++,1===v&&1===y||2===v&&1===y||3===v&&2===y?(0,r.jsx)("span",{className:"custom-highlight-orange",children:i},s):(0,r.jsx)("span",{...n},s);if("string"==typeof i&&"sql"===i.trim())return w++,1===w?(0,r.jsx)("span",{className:"custom-highlight-green",children:i},s):2===w||3===w?(0,r.jsx)("span",{className:"custom-highlight-orange",children:i},s):(0,r.jsx)("span",{...n},s);if("("===i||"{"===i||"["===i){b.push(i);const e=b.length,t=k(e);return"string"==typeof t?(0,r.jsx)("span",{className:t,children:i},s):(0,r.jsx)("span",{style:t,children:i},s)}if(")"===i||"}"===i||"]"===i){const e=b.length,t=k(e);let n;n="string"==typeof t?(0,r.jsx)("span",{className:t,children:i},s):(0,r.jsx)("span",{style:t,children:i},s);const o=b[b.length-1];return(")"===i&&"("===o||"}"===i&&"{"===o||"]"===i&&"["===o)&&b.pop(),n}return d!==i?(0,r.jsx)("span",{dangerouslySetInnerHTML:{__html:d}},s):(0,r.jsx)("span",{...n},s)}))},s)}))]})}})]})}},8453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>l});var n=s(6540);const i={},r=n.createContext(i);function o(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);