"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5378],{5495:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(6540),h=n(1765),s=n(4848);(void 0!==n.g?n.g:window).Prism=h.My;const o={...h.Zj.github,plain:{...h.Zj.github.plain,backgroundColor:"#2d2d2d",color:"#ffffff"},styles:h.Zj.github.styles.map((e=>({...e,types:e.types})))},r={from:"custom-highlight-pink",import:"custom-highlight-pink",pass:"custom-highlight-pink","|":"custom-highlight-pink","=":"custom-highlight-pink","*":"custom-highlight-pink","/":"custom-highlight-pink","+":"custom-highlight-pink",timbal:"custom-highlight-green",Agent:"custom-highlight-green",steps:"custom-highlight-green",perplexity:"custom-highlight-green",InMemorySaver:"custom-highlight-green",fal:"custom-highlight-green",text_to_image:"custom-highlight-green",RunContext:"custom-highlight-green","@abstractmethod":"custom-highlight-green",put:"custom-highlight-green",get_last:"custom-highlight-green",abc:"custom-highlight-green",ABC:"custom-highlight-green",twilio:"custom-highlight-green",whatsapp:"custom-highlight-green",model:"custom-highlight-orange",None:"custom-highlight-purple",base:"custom-highlight-green",CustomSaver:"custom-highlight-green",BaseSaver:"custom-highlight-green",Snapshot:"custom-highlight-green",query:"custom-highlight-orange",context:"custom-highlight-orange",system_prompt:"custom-highlight-orange",tools:"custom-highlight-orange",parent_id:"custom-highlight-orange",id:"custom-highlight-orange",model_id:"custom-highlight-orange",to:"custom-highlight-orange",message:"custom-highlight-orange",resource:"custom-highlight-orange",self:"custom-highlight-orange",path:"custom-highlight-orange",snapshot:"custom-highlight-orange",max_results:"custom-highlight-orange",message_id:"custom-highlight-orange",thread_id:"custom-highlight-orange",subject:"custom-highlight-orange",body:"custom-highlight-orange",template_sid:"custom-highlight-orange",template_params:"custom-highlight-orange",scope:"custom-highlight-orange",folder:"custom-highlight-orange",destination:"custom-highlight-orange",text:"custom-highlight-orange",voice_id:"custom-highlight-orange",memory_id:"custom-highlight-orange",location:"custom-highlight-orange",celsius:"custom-highlight-orange",fahrenheit:"custom-highlight-orange",threshold:"custom-highlight-orange",full_name:"custom-highlight-orange",memory_window_size:"custom-highlight-orange","(":"custom-highlight-yellow-dark",")":"custom-highlight-yellow-dark","[":"custom-highlight-purple-pink","]":"custom-highlight-purple-pink","{":"custom-highlight-yellow-dark","}":"custom-highlight-yellow-dark",",":"#fffff",Flow:"custom-highlight-green",await:"custom-highlight-pink",as:"custom-highlight-pink",else:"custom-highlight-pink",def:"custom-highlight-blue",async:"custom-highlight-blue",class:"custom-highlight-blue","-":"#fffff",">":"#fffff",":":"#fffff",".":"#fffff",state:"custom-highlight-green",savers:"custom-highlight-green",sharepoint:"custom-highlight-green",Tool:"custom-highlight-green",list_directory:"custom-highlight-green-fn",get_first_name:"custom-highlight-green-fn",get_last_name:"custom-highlight-green-fn",check_full_name:"custom-highlight-green-fn",abstractmethod:"custom-highlight-green-fn",main:"custom-highlight-green-fn",gen_images:"custom-highlight-green-fn",download_file:"custom-highlight-green-fn",TimbalPlatformSaver:"custom-highlight-green",sql:"custom-highlight-green",postgres:"custom-highlight-green",return:"custom-highlight-pink",for:"custom-highlight-pink",in:"custom-highlight-pink",if:"custom-highlight-pink",datetime:"custom-highlight-green",elevenlabs:"custom-highlight-green",gmail:"custom-highlight-green",JSONLSaver:"custom-highlight-green",openai:"custom-highlight-green",messages:"custom-highlight-green",types:"custom-highlight-green",File:"custom-highlight-green",postgres_query:"custom-highlight-green-fn",PGConfig:"custom-highlight-green",get_message:"custom-highlight-green-fn",get_thread:"custom-highlight-green-fn",get_datetime:"custom-highlight-green-fn",send_message:"custom-highlight-green-fn",run_sql_query:"custom-highlight-green-fn",create_draft_message:"custom-highlight-green-fn",send_whatsapp_message:"custom-highlight-green-fn",send_whatsapp_template:"custom-highlight-green-fn",openai_stt:"custom-highlight-green-fn",elevenlabs_tts:"custom-highlight-green-fn",validate:"custom-highlight-green-fn",complete:"custom-highlight-green-fn",print:"custom-highlight-green-fn",search:"custom-highlight-green-fn",search_internet:"custom-highlight-green-fn",stt:"custom-highlight-green-fn",tts:"custom-highlight-green-fn",run:"custom-highlight-green-fn",search_web:"custom-highlight-green-fn",set_input:"custom-highlight-green-fn",extract_text:"custom-highlight-green-fn",text_processor:"custom-highlight-green-fn",convert_to_database:"custom-highlight-green-fn",get_weather:"custom-highlight-green-fn",get_time:"custom-highlight-green-fn",add_step:"custom-highlight-green-fn",add_link:"custom-highlight-green-fn",set_output:"custom-highlight-green-fn",set_data_map:"custom-highlight-green-fn",set_data_value:"custom-highlight-green-fn",get_temperature_celsius:"custom-highlight-green-fn",celsius_to_fahrenheit:"custom-highlight-green-fn",check_threshold:"custom-highlight-green-fn",parse_documentation:"custom-highlight-green-fn",create_database:"custom-highlight-green-fn",add_llm:"custom-highlight-green-fn",compile:"custom-highlight-green-fn",str:"custom-highlight-green"},g=new RegExp(`(${Object.keys(r).map((e=>/^[a-zA-Z0-9_]+$/.test(e)?`\\b${e}\\b`:e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"))).join("|")})`,"g"),a=/"([^"]*)"/g;function l(e){const{title:t,children:n,highlight:l}=e,[c,m]=(0,i.useState)(!1),u=l?l.split(",").map((e=>parseInt(e.trim()))):[];return(0,s.jsxs)("div",{className:"custom-codeblock-container",style:{borderRadius:"12px",overflow:"hidden",border:"1px solid #333",marginBottom:"1.5em",position:"relative"},children:[t&&(0,s.jsx)("div",{style:{background:"#2d2d2d",color:"#fff",padding:"0.3em 1em",fontSize:"0.85em",borderBottom:"1.5px solid #444",letterSpacing:"0.01em",display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,s.jsx)("span",{children:t})}),(0,s.jsx)("div",{style:{position:"relative"},children:(0,s.jsx)(h.f4,{theme:o,...e,children:n=>{let{className:i,style:h,tokens:o,getLineProps:l,getTokenProps:d}=n;const p=o.map((e=>e.map((e=>e.content)).join(""))).join("\n");let f=0,x=0,y=0,w=0;o.forEach((e=>{e.forEach((e=>{const t=d({token:e}).children;"string"==typeof t&&"state_saver"===t.trim()&&x++,"string"==typeof t&&"audio_file"===t.trim()&&y++,"string"==typeof t&&"db_config"===t.trim()&&w++,"string"==typeof t&&"sql"===t.trim()&&0}))}));let j=0,_=0,b=0,v=0,k=[];const S=e=>{const t=(e-1)%3;return 0===t?"custom-highlight-yellow-dark":1===t?{color:"#ff69b4"}:{color:"#42a5f5"}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:"copy-icon-btn"+(c?" copied":""),onClick:()=>{navigator.clipboard.writeText(p),m(!0),setTimeout((()=>m(!1)),2e3)},"aria-label":"Copy code",type:"button",style:{position:"absolute",top:t?16:12,right:"1em",zIndex:10,background:"rgba(30,30,30,0.7)",border:"none",borderRadius:"6px",padding:"4px",cursor:"pointer",pointerEvents:"auto",transition:"opacity 0.2s, background 0.2s"},children:c?(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{fill:"#fff",d:"m9.55 15.15l8.475-8.475q.3-.3.7-.3t.7.3t.3.713t-.3.712l-9.175 9.2q-.3.3-.7.3t-.7-.3L4.55 13q-.3-.3-.288-.712t.313-.713t.713-.3t.712.3z"})}):(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",children:(0,s.jsxs)("g",{fill:"none",stroke:"#fff",strokeWidth:"1.5",children:[(0,s.jsx)("path",{d:"M6 11c0-2.828 0-4.243.879-5.121C7.757 5 9.172 5 12 5h3c2.828 0 4.243 0 5.121.879C21 6.757 21 8.172 21 11v5c0 2.828 0 4.243-.879 5.121C19.243 22 17.828 22 15 22h-3c-2.828 0-4.243 0-5.121-.879C6 20.243 6 18.828 6 16z"}),(0,s.jsx)("path",{d:"M6 19a3 3 0 0 1-3-3v-6c0-3.771 0-5.657 1.172-6.828S7.229 2 11 2h4a3 3 0 0 1 3 3"})]})})}),(0,s.jsx)("pre",{className:i,style:{...h,border:"none",borderRadius:0,color:"bash"===e.language?"#ffffff":h.color,margin:0,position:"relative"},children:o.map(((t,n)=>{const i=t.map((e=>d({token:e}).children)).join(""),h=u.includes(n+1),c={...l({line:t}).style,...h?{backgroundColor:"rgba(255, 255, 255, 0.1)",borderLeft:"3px solid #bcb6ff",paddingLeft:"8px",marginLeft:"-8px"}:{}};return/^\s*#/.test(i)?(0,s.jsx)("div",{...l({line:t}),style:c,children:t.map(((t,n)=>{const i=d({token:t});return(0,s.jsx)("span",{className:(e.language,"custom-highlight-comment"),children:i.children},n)}))},n):(0,s.jsxs)("div",{...l({line:t}),style:c,children:[t.map(((t,n)=>{const i=d({token:t});let h=i.children;if("bash"===e.language)return(0,s.jsx)("span",{style:{color:"#ffffff"},children:h},n);const o=[];let l,c=0;for(;null!==(l=a.exec(h));){if(l.index>c){let e=h.slice(c,l.index).replace(g,(e=>`<span class="${r[e]}">${e}</span>`));e=e.replace(/\\b\\d+(?:\\.\\d+)?\\b/g,(e=>`<span class="custom-highlight-purple">${e}</span>`)),o.push(e)}o.push(`<span class="custom-highlight-yellow">${l[0]}</span>`),c=l.index+l[0].length}if(c<h.length){let e=h.slice(c).replace(g,(e=>`<span class="${r[e]}">${e}</span>`));e=e.replace(/\\b\\d+(?:\\.\\d+)?\\b/g,(e=>`<span class="custom-highlight-purple">${e}</span>`)),o.push(e)}const m=o.join("");if("string"==typeof h&&"prompt"===h.trim())return f++,1===f?(0,s.jsx)("span",{className:"custom-highlight-orange",children:h},n):2===f?(0,s.jsx)("span",{style:{color:"#fff"},children:h},n):(0,s.jsx)("span",{...i},n);if("string"==typeof h&&"audio_file"===h.trim())return _++,3===y&&2===_?(0,s.jsx)("span",{className:"custom-highlight-orange",children:h},n):(0,s.jsx)("span",{...i},n);if("string"==typeof h&&"state_saver"===h.trim())return j++,1===x&&1===j||2===x&&1===j||3===x&&2===j?(0,s.jsx)("span",{className:"custom-highlight-orange",children:h},n):(0,s.jsx)("span",{...i},n);if("string"==typeof h&&"db_config"===h.trim())return b++,1===w&&1===b||2===w&&1===b||3===w&&2===b?(0,s.jsx)("span",{className:"custom-highlight-orange",children:h},n):(0,s.jsx)("span",{...i},n);if("string"==typeof h&&"sql"===h.trim())return v++,1===v?(0,s.jsx)("span",{className:"custom-highlight-green",children:h},n):2===v||3===v?(0,s.jsx)("span",{className:"custom-highlight-orange",children:h},n):(0,s.jsx)("span",{...i},n);if("("===h||"{"===h||"["===h){k.push(h);const e=k.length,t=S(e);return"string"==typeof t?(0,s.jsx)("span",{className:t,children:h},n):(0,s.jsx)("span",{style:t,children:h},n)}if(")"===h||"}"===h||"]"===h){const e=k.length,t=S(e);let i;i="string"==typeof t?(0,s.jsx)("span",{className:t,children:h},n):(0,s.jsx)("span",{style:t,children:h},n);const o=k[k.length-1];return(")"===h&&"("===o||"}"===h&&"{"===o||"]"===h&&"["===o)&&k.pop(),i}return m!==h?(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:m}},n):(0,s.jsx)("span",{...i},n)})),n===o.length-1&&(0,s.jsx)("span",{style:{display:"inline-block",width:"1em"}})]},n)}))})]})}})})]})}},7065:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>g,default:()=>m,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"agents/rewind","title":"Rewind","description":"The rewind feature in Timbal allows you to branch or \\"rewind\\" the memory of an agent or flow by changing the parent_id in the RunContext. This is useful when you want to continue a conversation from a previous point, ignoring any newer context that was added after that point.","source":"@site/docs/agents/rewind.md","sourceDirName":"agents","slug":"/agents/rewind","permalink":"/agents/rewind","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Rewind","sidebar":"docsSidebar"},"sidebar":"docsSidebar","previous":{"title":"Adding Memory","permalink":"/agents/memory"},"next":{"title":"Tools","permalink":"/agents/tools"}}');var h=n(4848),s=n(8453),o=n(5495);const r={title:"Rewind",sidebar:"docsSidebar"},g="Rewind",a={},l=[{value:"How Rewind Works",id:"how-rewind-works",level:2},{value:"Example",id:"example",level:2},{value:"What happens under the hood?",id:"what-happens-under-the-hood",level:2},{value:"Summary",id:"summary",level:2}];function c(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(t.header,{children:(0,h.jsx)(t.h1,{id:"rewind",children:"Rewind"})}),"\n",(0,h.jsxs)(t.p,{children:["The ",(0,h.jsx)(t.strong,{children:"rewind"}),' feature in Timbal allows you to branch or "rewind" the memory of an agent or flow by changing the ',(0,h.jsx)(t.code,{children:"parent_id"})," in the ",(0,h.jsx)(t.code,{children:"RunContext"}),". This is useful when you want to continue a conversation from a previous point, ignoring any newer context that was added after that point."]}),"\n",(0,h.jsx)(t.hr,{}),"\n",(0,h.jsx)(t.h2,{id:"how-rewind-works",children:"How Rewind Works"}),"\n",(0,h.jsxs)(t.p,{children:["Normally, when you pass a ",(0,h.jsx)(t.code,{children:"parent_id"})," to a new ",(0,h.jsx)(t.code,{children:"RunContext"}),", the agent loads the memory up to that point. If you change the ",(0,h.jsx)(t.code,{children:"parent_id"})," to an earlier run, the agent will only have access to the memory up to that run, and ",(0,h.jsx)(t.strong,{children:"not"})," any of the memory added after."]}),"\n",(0,h.jsx)(t.p,{children:"This allows you to:"}),"\n",(0,h.jsxs)(t.ul,{children:["\n",(0,h.jsx)(t.li,{children:"Branch the conversation from any previous point."}),"\n",(0,h.jsx)(t.li,{children:"Ignore or overwrite later context by starting from an earlier memory state."}),"\n"]}),"\n",(0,h.jsx)(t.h2,{id:"example",children:"Example"}),"\n",(0,h.jsx)(t.p,{children:"Let's see a practical example:"}),"\n",(0,h.jsx)(o.A,{language:"python",code:'from timbal import Agent\nfrom timbal.state import RunContext\nfrom timbal.state.savers import InMemorySaver\n\nagent = Agent(\n  model="gpt-4o-mini",\n  state_saver=InMemorySaver(),\n)\n\n# Step 1: Start the conversation\nrun1 = await agent.complete(prompt="Hello")\n# Memory: ["Hello"]\n\n# Step 2: Add a name\nrun2 = await agent.complete(\n  context=RunContext(parent_id=run1.run_id),\n  prompt="My name is David"\n)\n# Memory: ["Hello", "My name is David"]\n\n# Step 3: Ask for the name (normal forward memory)\nrun3 = await agent.complete(\n  context=RunContext(parent_id=run2.run_id),\n  prompt="What is my name?"\n)\nprint(run3.output.content[0].text)\n# Output: "Your name is David!"\n\n# Step 4: REWIND - branch from the first message, ignoring the \'David\' memory\nrun4 = await agent.complete(\n  context=RunContext(parent_id=run1.run_id),\n  prompt="What is my name?"\n)\nprint(run4.output.content[0].text)\n# The agent does NOT know your name, because it only sees the memory up to "Hello"'}),"\n",(0,h.jsx)(t.h2,{id:"what-happens-under-the-hood",children:"What happens under the hood?"}),"\n",(0,h.jsxs)(t.ul,{children:["\n",(0,h.jsxs)(t.li,{children:["When you set ",(0,h.jsx)(t.code,{children:"parent_id"})," to an earlier run, the agent loads only the memory up to that run."]}),"\n",(0,h.jsx)(t.li,{children:"Any context added after that run is ignored for this new branch."}),"\n",(0,h.jsx)(t.li,{children:'This is like "rewinding" the conversation and starting a new path from that point.'}),"\n"]}),"\n",(0,h.jsx)(t.p,{children:(0,h.jsx)(t.strong,{children:"Visual Diagram"})}),"\n",(0,h.jsx)(o.A,{language:"bash",code:'Start \u2500\u2500\u25b6 "My name is David" \u2500\u2500\u25b6 "What is my name?" (\u2192 "Your name is David!")\n    \u2502\n    \u2514\u2500\u2500\u2500\u25b6 (rewind) "What is my name?" (\u2192 Agent does NOT know your name)'}),"\n",(0,h.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,h.jsxs)(t.ul,{children:["\n",(0,h.jsxs)(t.li,{children:[(0,h.jsx)(t.strong,{children:"Rewind"})," lets you branch or restart the conversation from any previous point by changing the ",(0,h.jsx)(t.code,{children:"parent_id"}),"."]}),"\n",(0,h.jsxs)(t.li,{children:["The agent will only see the memory up to the specified ",(0,h.jsx)(t.code,{children:"parent_id"}),"."]}),"\n",(0,h.jsx)(t.li,{children:'This is useful for "what if" scenarios, testing, or branching conversations.'}),"\n"]})]})}function m(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,h.jsx)(t,{...e,children:(0,h.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var i=n(6540);const h={},s=i.createContext(h);function o(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(h):e.components||h:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);